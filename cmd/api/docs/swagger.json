{
  "openapi":"3.0.3",
  "info":{
    "title":"Kinder Library API",
    "version":"1.0.0"
  },
  "tags":[
    {
      "name":"Health",
      "description":"API healthcheck and system diagnostics"
    },
    {
      "name":"Books",
      "description":"Operations related to books"
    }
  ],
  "paths":{
    "/v1/healthcheck":{
      "get":{
        "tags":[
          "Health"
        ],
        "summary":"Health check",
        "description":"Returns API availability and version.",
        "responses":{
          "200":{
            "description":"API is available",
            "content":{
              "application/json":{
                "schema":{
                  "$ref":"#/components/schemas/HealthCheck"
                }
              }
            }
          }
        }
      }
    },
    "/v1/books":{
      "get":{
        "tags":[
          "Books"
        ],
        "summary":"List all books with pagination",
        "security":[
          {
            "BasicAuth":[

            ]
          }
        ],
        "parameters":[
          {
            "name":"page",
            "in":"query",
            "schema":{
              "type":"string"
            },
            "description":"Page number",
            "required":true
          },
          {
            "name":"page_size",
            "in":"query",
            "schema":{
              "type":"string"
            },
            "description":"Number of items per page",
            "required":true
          }
        ],
        "responses":{
          "200":{
            "description":"A list of books",
            "content":{
              "application/json":{
                "schema":{
                  "$ref":"#/components/schemas/BookListResponse"
                }
              }
            }
          },
          "400":{
            "description":"Invalid input or bad request"
          },
          "404":{
            "description":"Page is out of bounds"
          },
          "422":{
            "description":"Validation failed"
          },
          "500":{
            "description":"Server error"
          }
        }
      },
      "post":{
        "tags":[
          "Books"
        ],
        "summary":"Insert a book",
        "security":[
          {
            "BasicAuth":[

            ]
          }
        ],
        "requestBody":{
          "required":true,
          "content":{
            "application/json":{
              "schema":{
                "$ref":"#/components/schemas/BookRequest"
              }
            }
          }
        },
        "responses":{
          "201":{
            "description":"Book successfully inserted",
            "content":{
              "application/json":{
                "schema":{
                  "$ref":"#/components/schemas/BookResponse"
                }
              }
            }
          },
          "400":{
            "description":"Invalid input or bad request"
          },
          "422":{
            "description":"Validation failed"
          },
          "500":{
            "description":"Server error"
          }
        }
      }
    },
    "/v1/books/{id}":{
      "put":{
        "tags":[
          "Books"
        ],
        "summary":"Update a book by ID",
        "security":[
          {
            "BasicAuth":[

            ]
          }
        ],
        "parameters":[
          {
            "name":"id",
            "in":"path",
            "required":true,
            "schema":{
              "type":"integer",
              "minimum":1
            }
          }
        ],
        "requestBody":{
          "required":true,
          "content":{
            "application/json":{
              "schema":{
                "$ref":"#/components/schemas/BookRequest"
              }
            }
          }
        },
        "responses":{
          "200":{
            "description":"Book successfully updated",
            "content":{
              "application/json":{
                "schema":{
                  "$ref":"#/components/schemas/BookResponse"
                }
              }
            }
          },
          "400":{
            "description":"Invalid input or bad request"
          },
          "404":{
            "description":"Book not found"
          },
          "422":{
            "description":"Validation failed"
          },
          "500":{
            "description":"Server error"
          }
        }
      },
      "delete":{
        "tags":[
          "Books"
        ],
        "summary":"Delete book",
        "security":[
          {
            "BasicAuth":[

            ]
          }
        ],
        "parameters":[
          {
            "name":"id",
            "in":"path",
            "required":true,
            "schema":{
              "type":"integer",
              "minimum":1
            },
            "description":"ID of the book to delete"
          }
        ],
        "responses":{
          "204":{
            "description":"Book successfully deleted"
          },
          "404":{
            "description":"Book not found"
          },
          "500":{
            "description":"Server error"
          }
        }
      }
    }
  },
  "components":{
    "schemas":{
      "HealthCheck":{
        "type":"object",
        "properties":{
          "status":{
            "type":"string",
            "example":"available"
          },
          "version":{
            "type":"string",
            "example":"1.0.0"
          }
        },
        "required":[
          "status",
          "version"
        ]
      },
      "BookRequest":{
        "type":"object",
        "properties":{
          "title":{
            "type":"string",
            "maxLength":500,
            "example":"The Catcher in the Rye"
          },
          "author":{
            "type":"string",
            "maxLength":200,
            "example":"J. D. Salinger"
          },
          "pages":{
            "type":"integer",
            "minimum":1,
            "example":277
          },
          "description":{
            "type":"string",
            "maxLength":1000,
            "example":"A novel about teenage rebellion."
          },
          "rating":{
            "type":"number",
            "format":"float",
            "minimum":0,
            "maximum":5,
            "example":4.24
          },
          "genres":{
            "type":"array",
            "maxItems":5,
            "items":{
              "type":"string",
              "minLength":1
            },
            "uniqueItems":true,
            "example":[
              "fiction",
              "classic",
              "coming-of-age"
            ]
          }
        },
        "required":[
          "title",
          "author",
          "pages"
        ]
      },
      "BookResponse":{
        "type":"object",
        "properties":{
          "book":{
            "$ref":"#/components/schemas/Book"
          }
        }
      },
      "Book":{
        "allOf":[
          {
            "type":"object",
            "properties":{
              "id":{
                "type":"integer",
                "format":"int64",
                "minimum":1,
                "example":1
              },
              "created_at":{
                "type":"string",
                "format":"date-time"
              },
              "updated_at":{
                "type":"string",
                "format":"date-time"
              }
            },
            "required":[
              "id",
              "created_at",
              "updated_at"
            ]
          },
          {
            "$ref":"#/components/schemas/BookRequest"
          }
        ]
      },
      "BookListResponse":{
        "type":"object",
        "properties":{
          "pagination":{
            "$ref":"#/components/schemas/Pagination"
          },
          "books":{
            "type":"array",
            "items":{
              "$ref":"#/components/schemas/Book"
            }
          }
        },
        "required":[
          "pagination",
          "books"
        ]
      },
      "Pagination":{
        "type":"object",
        "properties":{
          "current_page":{
            "type":"integer",
            "example":1
          },
          "page_size":{
            "type":"integer",
            "example":5
          },
          "first_page":{
            "type":"integer",
            "example":1
          },
          "last_page":{
            "type":"integer",
            "example":4
          },
          "total_records":{
            "type":"integer",
            "example":20
          }
        },
        "required":[
          "current_page",
          "page_size",
          "first_page",
          "last_page",
          "total_records"
        ]
      }
    },
    "securitySchemes":{
      "BasicAuth":{
        "type":"http",
        "scheme":"basic"
      }
    }
  }
}